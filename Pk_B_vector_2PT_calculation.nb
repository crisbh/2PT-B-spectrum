(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 13.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     31311,        754]
NotebookOptionsPosition[     30208,        731]
NotebookOutlinePosition[     30680,        749]
CellTagsIndexPosition[     30637,        746]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Load", " ", "the", " ", 
    RowBox[{"data", ".", " ", "Notice"}], " ", "that", " ", "in", " ", "our", 
    " ", "expression", " ", "we", " ", "use", " ", "Pk", " ", "rather", " ", 
    "than", " ", "Tk"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"ClearAll", ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"CAMBPkFile", "=", "\"\<Pk_matter_z_0.txt\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DataInput", " ", "=", " ", 
     RowBox[{"Import", "[", 
      RowBox[{
       RowBox[{"FileNameJoin", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"NotebookDirectory", "[", "]"}], ",", "CAMBPkFile"}], "}"}],
         "]"}], ",", " ", "\"\<Table\>\""}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PkData", " ", "=", " ", 
     RowBox[{"DataInput", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kData", "=", 
     RowBox[{"DataInput", "[", 
      RowBox[{"[", 
       RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kMin", "=", 
     RowBox[{"Min", "[", "kData", "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"kMax", "=", 
     RowBox[{"Max", "[", "kData", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Set", " ", "relevant", " ", "cosmological", " ", "parameters", " ", 
     "and", " ", "functions"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"H0", "=", "68"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Omegam0", "=", "0.311"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"SpeedOfLight", "=", 
     RowBox[{"3", "*", 
      RowBox[{"10", "^", "5"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Hubble", "[", "z_", "]"}], ":=", 
    RowBox[{"H0", "*", 
     RowBox[{"Sqrt", "[", 
      RowBox[{
       RowBox[{"Omegam0", "*", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", "z"}], ")"}], "^", "3"}]}], "+", "1", "-", 
       "Omegam0"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Omegama", "[", "z_", "]"}], ":=", 
    RowBox[{"Omegam0", "*", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"1", "+", "z"}], ")"}], "^", "3"}], "/", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"Hubble", "[", "z", "]"}], "/", "H0"}], ")"}], "^", 
       "2"}]}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"GrowthRatef", "[", "z_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Omegama", "[", "z", "]"}], "^", 
     RowBox[{"(", 
      RowBox[{"6", "/", "11"}], ")"}]}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Overall", " ", "amplitude", " ", "factor", " ", "of", " ", "the", " ", 
     "B", " ", "power", " ", "spectrum"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AmpDeltaB", "=", 
     RowBox[{
      RowBox[{"9.0", "/", "2.0"}], "*", 
      RowBox[{"Omegam0", "^", "2"}], "*", 
      RowBox[{"H0", "^", "4"}], "*", 
      RowBox[{
       RowBox[{"Hubble", "[", "0", "]"}], "^", "2"}], "*", 
      RowBox[{
       RowBox[{
        RowBox[{"GrowthRatef", "[", "0", "]"}], "^", "2"}], "/", 
       RowBox[{"SpeedOfLight", "^", "6"}]}]}]}], ";"}], "\[IndentingNewLine]",
    "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Interpolate", " ", "data", " ", "for", " ", "convenient", " ", 
     "integration"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"PkInter", "=", 
     RowBox[{"Interpolation", "[", "DataInput", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Impose", " ", "sensible", " ", "cutoff", " ", "if", " ", "trying", " ", 
     "to", " ", "match", " ", "simulation", " ", 
     RowBox[{"results", ".", " ", "Also"}], " ", "avoids", " ", 
     RowBox[{"extrapolation", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"kminCutoff", "=", "kMin"}], ";", "\[IndentingNewLine]", 
     RowBox[{"kmaxCutoff", "=", "kMax"}], ";"}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kminCutoff", "=", "0.01"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"kmaxCutoff", "=", "12"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"kminCutoff", "=", 
      RowBox[{"0.8", "*", 
       RowBox[{"(", 
        RowBox[{"2", "*", 
         RowBox[{"Pi", "/", "256"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
     
     RowBox[{"kmaxCutoff", "=", 
      RowBox[{"N", "[", 
       RowBox[{"Pi", "*", 
        RowBox[{"1024", "/", "256"}]}], "]"}]}], ";"}], "*)"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Pk", "[", "k_", "]"}], ":=", 
     RowBox[{"Piecewise", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"PkInter", "[", "k", "]"}], ",", 
          RowBox[{"kminCutoff", "<=", "k", "<=", "kmaxCutoff"}]}], "}"}], 
        "}"}], ",", "0"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Define", " ", "the", " ", "dimensionless", " ", "power", " ", "spectrum",
      " ", "\[CapitalDelta]", " ", "for", " ", "each", " ", 
     RowBox[{"field", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Matter", " ", "overdensity"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DeltaMat", "[", "k_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"k", "^", "3"}], "/", 
       RowBox[{"(", 
        RowBox[{"2", 
         RowBox[{"\[Pi]", "^", "2"}]}], ")"}]}], "*", 
      RowBox[{"Pk", "[", "k", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Velocity", " ", "potential"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DeltaVel", "[", "k_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"k", "^", "3"}], "/", 
       RowBox[{"(", 
        RowBox[{"2", 
         RowBox[{"\[Pi]", "^", "2"}]}], ")"}]}], "*", 
      RowBox[{
       RowBox[{"Pk", "[", "k", "]"}], "/", 
       RowBox[{"k", "^", "4"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Cross", " ", "spectrum"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DeltaMxV", "[", "k_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"k", "^", "3"}], "/", 
       RowBox[{"(", 
        RowBox[{"2", 
         RowBox[{"\[Pi]", "^", "2"}]}], ")"}]}], "*", 
      RowBox[{
       RowBox[{"Pk", "[", "k", "]"}], "/", 
       RowBox[{"k", "^", "2"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "Define", " ", "the", " ", "integration", " ", "kernels", " ", "and", " ",
      "double", " ", "integral", " ", "for", " ", "the", " ", 
     "\[CapitalDelta]B", " ", "calculation"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"PIKernel", "[", 
      RowBox[{"u_", ",", "w_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"1", "/", 
       RowBox[{"u", "^", "2"}]}], "*", 
      RowBox[{"1", "/", 
       RowBox[{"w", "^", "4"}]}], "*", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"4", 
         RowBox[{"w", "^", "2"}]}], "-", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "+", 
           RowBox[{"w", "^", "2"}], "-", 
           RowBox[{"u", "^", "2"}]}], ")"}], "^", "2"}]}], ")"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DeltaCombination", "[", 
      RowBox[{"k_", ",", "u_", ",", "w_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"DeltaMat", "[", 
        RowBox[{"k", "*", "u"}], "]"}], " ", "*", 
       RowBox[{"DeltaVel", "[", 
        RowBox[{"k", "*", "w"}], "]"}]}], "-", 
      RowBox[{
       RowBox[{"w", "/", "u"}], "*", 
       RowBox[{"DeltaMxV", "[", 
        RowBox[{"k", "*", "u"}], "]"}], " ", "*", 
       RowBox[{"DeltaMxV", "[", 
        RowBox[{"k", "*", "w"}], "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Idu", "[", 
      RowBox[{"k_", ",", 
       RowBox[{"w_", "?", "NumericQ"}]}], "]"}], ":=", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"PIKernel", "[", 
         RowBox[{"u", ",", "w"}], "]"}], "*", 
        RowBox[{"DeltaCombination", "[", 
         RowBox[{"k", ",", "u", ",", "w"}], "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"u", ",", 
         RowBox[{"Evaluate", "[", 
          RowBox[{"Abs", "[", 
           RowBox[{"1", "-", "w"}], "]"}], "]"}], ",", " ", 
         RowBox[{"1", "+", "w"}]}], "}"}], ",", 
       RowBox[{"Method", "->", "\"\<LocalAdaptive\>\""}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"Idw", "[", "k_", "]"}], ":=", 
     RowBox[{"NIntegrate", "[", 
      RowBox[{
       RowBox[{"Idu", "[", 
        RowBox[{"k", ",", "w"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"w", ",", "0", ",", "Infinity"}], "}"}], ",", " ", 
       RowBox[{"Method", "->", "\"\<LocalAdaptive\>\""}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"DeltaB", "[", "k_", "]"}], ":=", 
     RowBox[{
      RowBox[{"1", "/", 
       RowBox[{"k", "^", "2"}]}], "*", 
      RowBox[{"Idw", "[", "k", "]"}]}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.930734966894663*^9, 3.930735041558407*^9}, {
   3.9307351260169*^9, 3.93073521015701*^9}, 3.9307352589462852`*^9, {
   3.930735448865595*^9, 3.930735526160142*^9}, {3.930735835077773*^9, 
   3.9307358967701483`*^9}, 3.930735936886183*^9, {3.930735971012528*^9, 
   3.9307360305935917`*^9}, {3.930736285764793*^9, 3.9307363334751472`*^9}, {
   3.930736510849636*^9, 3.930736574942421*^9}, {3.9307366097107286`*^9, 
   3.930736630936602*^9}, {3.9307367070319967`*^9, 3.930736707743167*^9}, {
   3.9307368579439697`*^9, 3.930736858209114*^9}, {3.930737259508376*^9, 
   3.930737270374481*^9}, {3.930737737495187*^9, 3.930737737723401*^9}, {
   3.930738571750328*^9, 3.930738628773026*^9}, {3.930819246919228*^9, 
   3.93081927309068*^9}, {3.9308194440671577`*^9, 3.930819512191368*^9}, {
   3.930819546340066*^9, 3.9308195536052856`*^9}, 3.930819631771512*^9, 
   3.930820036968719*^9, {3.930824073190815*^9, 3.930824077208418*^9}, 
   3.93082411547779*^9, {3.9308245161059732`*^9, 3.9308245390233192`*^9}, 
   3.93082457359407*^9, {3.930824796478898*^9, 3.930824796595717*^9}, 
   3.930835733693399*^9, {3.9308368406560907`*^9, 3.930836856791857*^9}, 
   3.9308371299889507`*^9, {3.930837273364717*^9, 3.930837274304727*^9}, {
   3.9308373043824453`*^9, 3.930837306756734*^9}, {3.930839250111918*^9, 
   3.9308393067302*^9}, {3.930839466223405*^9, 3.930839475874941*^9}, {
   3.930839530738421*^9, 3.930839532463806*^9}, {3.930840328349079*^9, 
   3.930840350484559*^9}, 3.9308403981903152`*^9, {3.9308407432834272`*^9, 
   3.930840799960949*^9}, {3.9310006710211678`*^9, 3.93100067350404*^9}, 
   3.9310007106808*^9, {3.9310020013057613`*^9, 3.9310020469671183`*^9}, {
   3.931002590172427*^9, 3.93100260139837*^9}, {3.9310026809523067`*^9, 
   3.931002687187804*^9}, {3.9310027323033333`*^9, 3.9310028160440617`*^9}, {
   3.931003403824144*^9, 3.931003414024569*^9}, 3.93100345991535*^9, {
   3.9310035956412573`*^9, 3.931003613232004*^9}, 3.931347609225161*^9, 
   3.931347642271389*^9, {3.9313478809421597`*^9, 3.9313479292890787`*^9}, {
   3.931347972529546*^9, 3.9313479955876713`*^9}, 3.931348036650681*^9, {
   3.9313516705223017`*^9, 3.9313516954890842`*^9}, {3.931351736880576*^9, 
   3.931351740127163*^9}, {3.931351877718967*^9, 3.931351892412672*^9}, {
   3.9313519304182043`*^9, 3.931351933868256*^9}, {3.931352279856588*^9, 
   3.9313522823250713`*^9}, {3.93135270820818*^9, 3.9313527109610033`*^9}, {
   3.93135435275288*^9, 3.931354353215411*^9}, {3.9313812548766823`*^9, 
   3.931381257161779*^9}, {3.9313814236608152`*^9, 3.931381425298334*^9}, {
   3.9313825635955973`*^9, 3.931382564246763*^9}, {3.931895975864914*^9, 
   3.931895990912088*^9}, {3.931941142502548*^9, 3.931941153564872*^9}, {
   3.9319415026748343`*^9, 3.9319415172645683`*^9}, {3.9319415510734367`*^9, 
   3.931941587615385*^9}, {3.9319416545808773`*^9, 3.931941799823566*^9}, {
   3.931942066385675*^9, 3.931942070230214*^9}, {3.931942332468409*^9, 
   3.931942335063698*^9}, {3.931942741868271*^9, 3.9319427457257032`*^9}, {
   3.931943506330291*^9, 3.931943539739621*^9}, {3.931943699409339*^9, 
   3.9319437003942537`*^9}, {3.9319438064591703`*^9, 3.931943812353819*^9}, {
   3.931949005269576*^9, 3.931949005395249*^9}, 3.931954343715283*^9, 
   3.93196248155828*^9, {3.9319629863188753`*^9, 3.931962986500896*^9}, {
   3.9319665279470987`*^9, 3.931966531392681*^9}, {3.9319666971217747`*^9, 
   3.9319667167076797`*^9}, {3.931966966452519*^9, 3.931966968653871*^9}, {
   3.931967100384651*^9, 3.931967135114875*^9}, {3.931967220773368*^9, 
   3.931967265615109*^9}, {3.931967373357758*^9, 3.9319673741515017`*^9}, {
   3.931967586021502*^9, 3.931967589715029*^9}, 3.9319679683714447`*^9, {
   3.931968374874262*^9, 3.931968415541957*^9}, {3.9319686435748262`*^9, 
   3.9319686876221943`*^9}, 3.931970151806136*^9, {3.932025447444363*^9, 
   3.932025533923347*^9}, {3.932025626978064*^9, 3.932025692618408*^9}, {
   3.9320257550265417`*^9, 3.9320257806901693`*^9}, {3.932025835384253*^9, 
   3.932025964914625*^9}, {3.932026917841854*^9, 3.932026918204776*^9}, {
   3.932033470888377*^9, 3.932033517541789*^9}, {3.932035367536066*^9, 
   3.932035378346457*^9}, {3.932035418974084*^9, 3.932035479387669*^9}, 
   3.932035636728499*^9},
 CellLabel->
  "In[633]:=",ExpressionUUID->"c8471e8b-ebdf-4ebf-b62b-2a8195e45c5f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Now", " ", "evaluate", " ", "all", " ", "to", " ", "calculate", " ", 
     "\[CapitalDelta]_BB", " ", "for", " ", "a", " ", "list", " ", "of", " ", 
     "k"}], "-", "modes"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"LogRange", "[", 
      RowBox[{"xmin_", ",", "xmax_", ",", "numPoints_"}], "]"}], ":=", 
     RowBox[{"Exp", "[", 
      RowBox[{"Range", "[", 
       RowBox[{
        RowBox[{"Log", "[", "xmin", "]"}], ",", 
        RowBox[{"Log", "[", "xmax", "]"}], ",", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Log", "[", "xmax", "]"}], "-", 
           RowBox[{"Log", "[", "xmin", "]"}]}], ")"}], "/", 
         RowBox[{"(", 
          RowBox[{"numPoints", "-", "1"}], ")"}]}]}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"kOutput", "=", 
     RowBox[{"LogRange", "[", 
      RowBox[{"0.01", ",", " ", "10", ",", " ", "10"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"DeltaBOut", "=", 
     RowBox[{"{", "}"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Table", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ResultInt", " ", "=", " ", 
        RowBox[{"DeltaB", "[", "k", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"DeltaBOut", ",", 
         RowBox[{"ResultInt", "*", "AmpDeltaB"}]}], "]"}], ";"}], 
      "\[IndentingNewLine]", ",", 
      RowBox[{"{", 
       RowBox[{"k", ",", "kOutput"}], "}"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"Print", " ", "results"}], " ", "*)"}], "\[IndentingNewLine]", 
   "kOutput", "\[IndentingNewLine]", "DeltaBOut"}]}]], "Input",
 CellChangeTimes->{{3.930737977675469*^9, 3.930737977763444*^9}, {
   3.9307380122829*^9, 3.930738042452674*^9}, {3.9307380825869513`*^9, 
   3.930738377291779*^9}, {3.930738448331731*^9, 3.9307384683130627`*^9}, {
   3.9307386614875937`*^9, 3.9307386735807333`*^9}, {3.930738906234913*^9, 
   3.930738906617546*^9}, 3.930739104071957*^9, {3.93073926469193*^9, 
   3.9307392694993267`*^9}, 3.93073931339187*^9, {3.930739439515316*^9, 
   3.930739461670877*^9}, {3.930739550154892*^9, 3.930739579867182*^9}, 
   3.930740688006599*^9, {3.93074072029282*^9, 3.930740724472999*^9}, {
   3.930819738997139*^9, 3.930819740459334*^9}, 3.9308247200237494`*^9, {
   3.930825056046386*^9, 3.930825168664835*^9}, {3.930825312508059*^9, 
   3.930825348218238*^9}, 3.930825393330542*^9, {3.931001130956382*^9, 
   3.93100113679916*^9}, 3.9310022548753653`*^9, {3.931002291520318*^9, 
   3.931002318207802*^9}, 3.9313474645964603`*^9, {3.9313524877880163`*^9, 
   3.9313524880323353`*^9}, 3.931353692288577*^9, {3.9313546174323263`*^9, 
   3.931354620340033*^9}, {3.931895765004178*^9, 3.931895766029862*^9}, {
   3.9318961893731613`*^9, 3.9318961912306004`*^9}, {3.9319673817018337`*^9, 
   3.9319673834910192`*^9}, {3.931968093962778*^9, 3.931968094093018*^9}, {
   3.932026005641757*^9, 3.932026031497356*^9}, {3.932026062907423*^9, 
   3.932026071265867*^9}, {3.932026129592519*^9, 3.932026130328052*^9}},
 CellLabel->
  "In[378]:=",ExpressionUUID->"3734b800-4373-4484-b2c2-0bc83072b333"],

Cell[TextData[StyleBox["Debugging  and Testing Area", "Section"]], "Text",
 CellChangeTimes->{{3.932026180042817*^9, 3.932026184235057*^9}, {
  3.932033573765126*^9, 
  3.932033575305972*^9}},ExpressionUUID->"b1c35597-8f67-497e-a1d4-\
50dc7bcdb21c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Plot", " ", "results"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"plotData", "=", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"kOutput", ",", "DeltaBOut"}], "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{"plotPB", "=", 
    RowBox[{"ListLogLogPlot", "[", 
     RowBox[{"plotData", ",", 
      RowBox[{"PlotStyle", "->", 
       RowBox[{"{", 
        RowBox[{"Blue", ",", 
         RowBox[{"PointSize", "[", "0.01", "]"}]}], "}"}]}], ",", 
      RowBox[{"AxesLabel", "->", 
       RowBox[{"{", 
        RowBox[{"\"\<k\>\"", ",", "\"\<\[CapitalDelta]_B(k)\>\""}], "}"}]}], 
      ",", 
      RowBox[{"PlotLabel", "->", "\"\<Results\>\""}], ",", 
      RowBox[{"GridLines", "->", "Automatic"}]}], "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.930819673000709*^9, 3.930819673450974*^9}, {
   3.930819731073621*^9, 3.930819779533008*^9}, {3.930825015078205*^9, 
   3.930825015840715*^9}, {3.930825203017581*^9, 3.93082520869046*^9}, 
   3.93100190313341*^9, {3.9310021668967743`*^9, 3.9310022290960073`*^9}, {
   3.931002425896473*^9, 3.931002435110529*^9}, {3.9310025710114107`*^9, 
   3.931002577129881*^9}, {3.931003428858802*^9, 3.9310034709989653`*^9}, {
   3.93135237204322*^9, 3.931352372484518*^9}, {3.931382829728218*^9, 
   3.931382870787595*^9}, {3.9313829468505983`*^9, 3.9313829699117327`*^9}, 
   3.931383203784059*^9, {3.931895923182131*^9, 3.931895934437109*^9}, {
   3.931937474794374*^9, 3.931937475138406*^9}, {3.9319413182261467`*^9, 
   3.9319413528433647`*^9}, {3.9319418905253267`*^9, 
   3.9319418910879602`*^9}, {3.931966621243805*^9, 3.9319666229973392`*^9}, 
   3.9319671430873337`*^9, 3.931968938240991*^9, {3.9319699272863293`*^9, 
   3.931969932620038*^9}, {3.9320261176154213`*^9, 3.9320261453789587`*^9}, {
   3.93202620961677*^9, 3.9320262196420603`*^9}},
 CellLabel->
  "In[433]:=",ExpressionUUID->"4e19ef5b-c266-4922-9f95-432c37dad0e3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Plot", " ", "Input", " ", "and", " ", "interpolated", " ", "Pk"}],
    " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"plotDataInput", "=", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"kData", ",", "PkData"}], "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"plotDataInter", "=", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"kData", ",", 
        RowBox[{"Pk", "/@", "kData"}]}], "}"}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"plotInput", "=", 
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{"plotDataInput", ",", 
       RowBox[{"PlotStyle", "->", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"PointSize", "[", "0.01", "]"}]}], "}"}]}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<k\>\"", ",", "\"\<P(k)\>\""}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", "\"\<Results\>\""}], ",", 
       RowBox[{"GridLines", "->", "Automatic"}], ",", 
       RowBox[{"DataRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0.01", ",", "0.05"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"plotInter", "=", 
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{"plotDataInter", ",", 
       RowBox[{"PlotStyle", "->", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"PointSize", "[", "0.005", "]"}]}], "}"}]}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<k\>\"", ",", "\"\<P(k)\>\""}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", "\"\<Results\>\""}], ",", 
       RowBox[{"GridLines", "->", "Automatic"}], ",", 
       RowBox[{"DataRange", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"0.01", ",", "0.05"}], "}"}]}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"combinedPlot", "=", 
    RowBox[{"Show", "[", 
     RowBox[{"plotInput", ",", "plotInter", ",", 
      RowBox[{"PlotLegends", "->", 
       RowBox[{"{", 
        RowBox[{"\"\<Input\>\"", ",", "\"\<Interpolated\>\""}], "}"}]}], ",", 
      
      RowBox[{"AxesLabel", "->", 
       RowBox[{"{", 
        RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
      RowBox[{"PlotLabel", "->", "\"\<Input and interpolated data\>\""}]}], 
     "]"}]}]}]}]], "Input",
 CellChangeTimes->{{3.93082018648809*^9, 3.930820205232057*^9}, {
   3.9308202683654413`*^9, 3.930820324817587*^9}, {3.930820357767124*^9, 
   3.930820374761653*^9}, {3.930824157727933*^9, 3.9308241615404587`*^9}, {
   3.930824266453977*^9, 3.930824266536435*^9}, {3.930824550109521*^9, 
   3.930824566810814*^9}, {3.931346889714052*^9, 3.93134694650885*^9}, {
   3.9313470255152493`*^9, 3.9313471187116528`*^9}, {3.9313472877202187`*^9, 
   3.931347369136845*^9}, {3.9313526293036203`*^9, 3.931352669912717*^9}, 
   3.9313529584106092`*^9, {3.9313530954104767`*^9, 3.9313531339509287`*^9}, {
   3.931354095791026*^9, 3.931354096741819*^9}, {3.9320262064536333`*^9, 
   3.932026254625965*^9}},
 CellLabel->
  "In[386]:=",ExpressionUUID->"c0085e7c-c0ee-4d4b-83c3-de8e55e4eb26"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Plot", " ", "the", " ", "\[CapitalDelta]", " ", "used", " ", "for", " ", 
    "the", " ", "final", " ", "integral"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"plotDeltaMat", "=", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"kData", ",", 
        RowBox[{"DeltaMat", "/@", "kData"}]}], "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"plotDeltaVel", "=", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"kData", ",", 
        RowBox[{"DeltaVel", "/@", "kData"}]}], "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"plotDeltaMxV", "=", 
     RowBox[{"Transpose", "[", 
      RowBox[{"{", 
       RowBox[{"kData", ",", 
        RowBox[{"DeltaMxV", "/@", "kData"}]}], "}"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"plotDeltaMat", "=", 
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{"plotDeltaMat", ",", 
       RowBox[{"PlotStyle", "->", 
        RowBox[{"{", 
         RowBox[{"Blue", ",", 
          RowBox[{"PointSize", "[", "0.005", "]"}]}], "}"}]}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<k\>\"", ",", "\"\<P(k)\>\""}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", "\"\<Results\>\""}], ",", 
       RowBox[{"GridLines", "->", "Automatic"}], ",", 
       RowBox[{"DataRange", "\[Rule]", "Automatic"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"plotDeltaVel", "=", 
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{"plotDeltaVel", ",", 
       RowBox[{"PlotStyle", "->", 
        RowBox[{"{", 
         RowBox[{"Red", ",", 
          RowBox[{"PointSize", "[", "0.005", "]"}]}], "}"}]}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<k\>\"", ",", "\"\<P(k)\>\""}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", "\"\<Results\>\""}], ",", 
       RowBox[{"GridLines", "->", "Automatic"}], ",", 
       RowBox[{"DataRange", "\[Rule]", "Automatic"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"plotDeltaMxV", "=", 
     RowBox[{"ListLogLogPlot", "[", 
      RowBox[{"plotDeltaMxV", ",", 
       RowBox[{"PlotStyle", "->", 
        RowBox[{"{", 
         RowBox[{"Cyan", ",", 
          RowBox[{"PointSize", "[", "0.005", "]"}]}], "}"}]}], ",", 
       RowBox[{"AxesLabel", "->", 
        RowBox[{"{", 
         RowBox[{"\"\<k\>\"", ",", "\"\<P(k)\>\""}], "}"}]}], ",", 
       RowBox[{"PlotLabel", "->", "\"\<Results\>\""}], ",", 
       RowBox[{"GridLines", "->", "Automatic"}], ",", 
       RowBox[{"DataRange", "\[Rule]", "Automatic"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Show", "[", 
    RowBox[{"plotDeltaMat", ",", "plotDeltaVel", ",", "plotDeltaMxV", ",", 
     RowBox[{"PlotRange", "->", "Automatic"}], ",", 
     RowBox[{"PlotLegends", "->", 
      RowBox[{"{", 
       RowBox[{"\"\<Input\>\"", ",", "\"\<Interpolated\>\""}], "}"}]}], ",", 
     RowBox[{"AxesLabel", "->", 
      RowBox[{"{", 
       RowBox[{"\"\<x\>\"", ",", "\"\<y\>\""}], "}"}]}], ",", 
     RowBox[{"PlotLabel", "->", "\"\<Input and interpolated data\>\""}]}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.9313475230866003`*^9, 3.931347564237825*^9}, {
  3.931353252590534*^9, 3.931353260812407*^9}, {3.931353353725329*^9, 
  3.9313533932919607`*^9}, {3.93135346495453*^9, 3.931353572382725*^9}, {
  3.9320263131910353`*^9, 3.932026335676174*^9}},
 CellLabel->
  "In[391]:=",ExpressionUUID->"4ff256ab-f356-49b5-a5cd-631041148e8c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"Plot", " ", "against", " ", "old", " ", 
    RowBox[{"data", ".", " ", "Apparently"}], " ", "this", " ", "is", " ", 
    "not", " ", "the", " ", 
    RowBox[{"paper", "'"}], "s", " ", "one", " ", "but", " ", "seems", " ", 
    "to", " ", "have", " ", "the", " ", "correct", " ", 
    RowBox[{"shape", "."}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
    "TestkBFile", "=", 
     "\"\<old_results/kbb_vector_z05_cutoffs2_L256_PM1024.dat\>\""}], ";", 
    RowBox[{
    "TestPBFile", "=", 
     "\"\<old_results/Pbb_vector_z05_cutoffs2_L256_PM1024.dat\>\""}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TestkB", " ", "=", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Import", "[", 
       RowBox[{
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], ",", "TestkBFile"}], 
          "}"}], "]"}], ",", " ", "\"\<Table\>\""}], "]"}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"TestPB", " ", "=", " ", 
     RowBox[{"Flatten", "[", 
      RowBox[{"Import", "[", 
       RowBox[{
        RowBox[{"FileNameJoin", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"NotebookDirectory", "[", "]"}], ",", "TestPBFile"}], 
          "}"}], "]"}], ",", " ", "\"\<Table\>\""}], "]"}], "]"}]}], 
    ";"}]}]}]], "Input",
 CellChangeTimes->{{3.931969500104653*^9, 3.931969511486361*^9}, {
  3.9319696154924507`*^9, 3.931969770691787*^9}, {3.9319698165150757`*^9, 
  3.931969849890524*^9}, {3.932026626221738*^9, 3.9320266298967543`*^9}, {
  3.932026680244886*^9, 3.932026763690628*^9}, {3.932035505484518*^9, 
  3.932035598662477*^9}},
 CellLabel->
  "In[600]:=",ExpressionUUID->"3f08f83d-a0cb-4780-85b5-84083ca95628"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"plotTestData", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"{", 
     RowBox[{"TestkB", ",", "TestPB"}], "}"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"plotTest", "=", 
    RowBox[{"ListLogLogPlot", "[", 
     RowBox[{"plotTestData", ",", 
      RowBox[{"PlotStyle", "->", 
       RowBox[{"{", 
        RowBox[{"Red", ",", 
         RowBox[{"PointSize", "[", "0.01", "]"}]}], "}"}]}], ",", 
      RowBox[{"AxesLabel", "->", 
       RowBox[{"{", 
        RowBox[{"\"\<k\>\"", ",", "\"\<\[CapitalDelta]_B(k)\>\""}], "}"}]}], 
      ",", 
      RowBox[{"PlotLabel", "->", "\"\<Results\>\""}], ",", 
      RowBox[{"GridLines", "->", "Automatic"}]}], "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{"Show", "[", 
  RowBox[{"plotPB", ",", "plotTest", ",", 
   RowBox[{"PlotRange", "->", "Automatic"}]}], 
  "]"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.931969792532207*^9, 3.931969805344882*^9}, {
  3.931969958913735*^9, 3.931969968711821*^9}, {3.932026799741659*^9, 
  3.932026810386538*^9}, {3.932033586954109*^9, 3.932033588479292*^9}},
 CellLabel->
  "In[603]:=",ExpressionUUID->"06903948-c6d8-465b-afe1-009a7baee9a9"]
},
WindowSize->{1024, 1099},
WindowMargins->{{Automatic, 0}, {Automatic, -185}},
TaggingRules-><|"TryRealOnly" -> False|>,
Magnification:>1.25 Inherited,
FrontEndVersion->"13.0 for Mac OS X ARM (64-bit) (February 4, 2022)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"ea232457-698e-42ab-8c49-f3a2a1dfed5b"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 14126, 338, 1520, "Input",ExpressionUUID->"c8471e8b-ebdf-4ebf-b62b-2a8195e45c5f"],
Cell[14687, 360, 3356, 71, 402, "Input",ExpressionUUID->"3734b800-4373-4484-b2c2-0bc83072b333"],
Cell[18046, 433, 249, 4, 64, "Text",ExpressionUUID->"b1c35597-8f67-497e-a1d4-50dc7bcdb21c"],
Cell[18298, 439, 1994, 40, 116, "Input",ExpressionUUID->"4e19ef5b-c266-4922-9f95-432c37dad0e3"],
Cell[20295, 481, 3185, 75, 324, "Input",ExpressionUUID->"c0085e7c-c0ee-4d4b-83c3-de8e55e4eb26"],
Cell[23483, 558, 3655, 90, 480, "Input",ExpressionUUID->"4ff256ab-f356-49b5-a5cd-631041148e8c"],
Cell[27141, 650, 1838, 46, 168, "Input",ExpressionUUID->"3f08f83d-a0cb-4780-85b5-84083ca95628"],
Cell[28982, 698, 1222, 31, 168, "Input",ExpressionUUID->"06903948-c6d8-465b-afe1-009a7baee9a9"]
}
]
*)

